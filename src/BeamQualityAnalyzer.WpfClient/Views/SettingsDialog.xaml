<Window x:Class="BeamQualityAnalyzer.WpfClient.Views.SettingsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="系统设置" 
        Height="600" 
        Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="{DynamicResource BackgroundBrush}"
        Style="{DynamicResource DefaultWindowStyle}">
    
    <Window.Resources>
        <!-- 合并全局主题资源 -->
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/DarkIndustrialTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <!-- 对话框特定样式覆盖 - 使用系统默认样式 -->
            <Style TargetType="TextBox">
                <Setter Property="Height" Value="30"/>
                <Setter Property="Margin" Value="0,0,0,10"/>
                <Setter Property="Background" Value="White"/>
                <Setter Property="Foreground" Value="Black"/>
            </Style>
            
            <Style TargetType="TextBlock" BasedOn="{StaticResource DefaultTextBlockStyle}">
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="Margin" Value="0,5,0,5"/>
            </Style>
            
            <Style TargetType="Button" BasedOn="{StaticResource DefaultButtonStyle}">
                <Setter Property="Height" Value="35"/>
                <Setter Property="MinWidth" Value="100"/>
                <Setter Property="Padding" Value="15,5"/>
            </Style>
            
            <Style TargetType="ComboBox" BasedOn="{StaticResource DefaultComboBoxStyle}">
                <Setter Property="Height" Value="30"/>
                <Setter Property="Margin" Value="0,0,0,10"/>
            </Style>
            
            <Style TargetType="CheckBox" BasedOn="{StaticResource DefaultCheckBoxStyle}">
                <Setter Property="Margin" Value="0,5,0,10"/>
            </Style>
        </ResourceDictionary>
    </Window.Resources>
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- 设置内容区 -->
        <TabControl Grid.Row="0" 
                    Style="{StaticResource DefaultTabControlStyle}">
            
            <!-- 服务器配置 -->
            <TabItem Header="服务器" Style="{StaticResource DefaultTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="服务器 URL:" Margin="0,5"/>
                        <TextBox Text="{Binding ServerUrl, UpdateSourceTrigger=PropertyChanged}"/>
                        
                        <CheckBox Content="自动重连" 
                                IsChecked="{Binding AutoReconnect}"
                                Margin="0,10"/>
                        
                        <TextBlock Text="重连间隔（毫秒）:" Margin="0,5"/>
                        <TextBox Text="{Binding ReconnectInterval, UpdateSourceTrigger=PropertyChanged}"/>
                        
                        <TextBlock Text="连接超时（毫秒）:" Margin="0,5"/>
                        <TextBox Text="{Binding ConnectionTimeout, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- 设备配置 -->
            <TabItem Header="设备" Style="{StaticResource DefaultTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="连接类型:" Margin="0,5"/>
                        <ComboBox SelectedItem="{Binding DeviceConnectionType}">
                            <ComboBoxItem Content="Virtual"/>
                            <ComboBoxItem Content="Serial"/>
                            <ComboBoxItem Content="USB"/>
                            <ComboBoxItem Content="Network"/>
                        </ComboBox>
                        
                        <TextBlock Text="端口名称:" Margin="0,10,0,5"/>
                        <TextBox Text="{Binding DevicePortName, UpdateSourceTrigger=PropertyChanged}"/>
                        
                        <TextBlock Text="波特率:" Margin="0,5"/>
                        <TextBox Text="{Binding DeviceBaudRate, UpdateSourceTrigger=PropertyChanged}"/>
                        
                        <TextBlock Text="采集频率（Hz）:" Margin="0,5"/>
                        <TextBox Text="{Binding DeviceAcquisitionFrequency, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- 算法配置 -->
            <TabItem Header="算法" Style="{StaticResource DefaultTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="默认波长（nm）:" Margin="0,5"/>
                        <TextBox Text="{Binding AlgorithmDefaultWavelength, UpdateSourceTrigger=PropertyChanged}"/>
                        
                        <TextBlock Text="最小数据点数:" Margin="0,10,0,5"/>
                        <TextBox Text="{Binding AlgorithmMinDataPoints, UpdateSourceTrigger=PropertyChanged}"/>
                        
                        <TextBlock Text="拟合容差:" Margin="0,5"/>
                        <TextBox Text="{Binding AlgorithmFitTolerance, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- 导出配置 -->
            <TabItem Header="导出" Style="{StaticResource DefaultTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="截图保存目录:" Margin="0,5"/>
                        <TextBox Text="{Binding ExportScreenshotDirectory, UpdateSourceTrigger=PropertyChanged}"/>
                        
                        <TextBlock Text="报告保存目录:" Margin="0,10,0,5"/>
                        <TextBox Text="{Binding ExportReportDirectory, UpdateSourceTrigger=PropertyChanged}"/>
                        
                        <TextBlock Text="图像格式:" Margin="0,10,0,5"/>
                        <ComboBox SelectedItem="{Binding ExportImageFormat}">
                            <ComboBoxItem Content="PNG"/>
                            <ComboBoxItem Content="JPEG"/>
                        </ComboBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- 数据库配置 -->
            <TabItem Header="数据库" Style="{StaticResource DefaultTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <CheckBox Content="启用远程数据库" 
                                IsChecked="{Binding RemoteDatabaseEnabled}"
                                Margin="0,5"/>
                        
                        <TextBlock Text="数据库类型:" Margin="0,10,0,5"/>
                        <ComboBox SelectedItem="{Binding RemoteDatabaseType}">
                            <ComboBoxItem Content="None"/>
                            <ComboBoxItem Content="MySQL"/>
                            <ComboBoxItem Content="SqlServer"/>
                        </ComboBox>
                        
                        <TextBlock Text="连接字符串:" Margin="0,10,0,5"/>
                        <TextBox Text="{Binding RemoteDatabaseConnectionString, UpdateSourceTrigger=PropertyChanged}"/>
                        
                        <Button Content="测试连接" 
                                Command="{Binding TestDatabaseConnectionCommand}"
                                Margin="0,10"
                                HorizontalAlignment="Left"/>
                        
                        <TextBlock Text="{Binding DatabaseTestResult}" 
                                 Margin="0,5"
                                 Foreground="{Binding DatabaseTestResultColor}"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- UI 配置 -->
            <TabItem Header="UI" Style="{StaticResource DefaultTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="主题:" Margin="0,5"/>
                        <ComboBox SelectedItem="{Binding UITheme}">
                            <ComboBoxItem Content="Dark"/>
                            <ComboBoxItem Content="Light"/>
                        </ComboBox>
                        
                        <TextBlock Text="图表刷新间隔（毫秒）:" Margin="0,10,0,5"/>
                        <TextBox Text="{Binding UIChartRefreshInterval, UpdateSourceTrigger=PropertyChanged}"/>
                        
                        <TextBlock Text="3D 可视化刷新间隔（毫秒）:" Margin="0,5"/>
                        <TextBox Text="{Binding UIVisualization3DRefreshInterval, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- 日志配置 -->
            <TabItem Header="日志" Style="{StaticResource DefaultTabItemStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock Text="最小日志级别:" Margin="0,5"/>
                        <ComboBox SelectedItem="{Binding LoggingMinimumLevel}">
                            <ComboBoxItem Content="Debug"/>
                            <ComboBoxItem Content="Information"/>
                            <ComboBoxItem Content="Warning"/>
                            <ComboBoxItem Content="Error"/>
                        </ComboBox>
                        
                        <TextBlock Text="日志保存目录:" Margin="0,10,0,5"/>
                        <TextBox Text="{Binding LoggingDirectory, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
        
        <!-- 按钮区 -->
        <StackPanel Grid.Row="1" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Margin="0,10,0,0">
            <Button Content="保存" 
                    Command="{Binding SaveCommand}"
                    Margin="0,0,10,0"/>
            <Button Content="取消" 
                    Command="{Binding CancelCommand}"/>
        </StackPanel>
    </Grid>
</Window>
